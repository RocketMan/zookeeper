{%- macro emitViewDJAlbum(albums, labelField) -%}
  {%~ for album in albums %}
    {%~ set artist = album.iscoll ? 'Various Artists' : album.artist %}
    {%~ set label = album[labelField] | replace({' Records': '', ' Recordings': ''}) ~%}
        <li>{{ artist }}&nbsp;&#8226;
          <i>
        {%- if album.tag -%}
              <a class='nav' href='?s=byAlbumKey&amp;n={{ album.tag }}&amp;action=search'>{{ album.album }}</a>
        {%- else -%}
              {{ album.album | smartURL }}
        {%- endif -%}
          </i>
      {%- if label | length -%}
          &nbsp;&#8226; ({{ label | smartURL }})
      {%~ endif %}
        </li>
  {%~ endfor %}
{%- endmacro -%}

<table class='djinfo' cellspacing=0>
{% if topPlays | length %}
  <tr><th align=left class='subhead'>{{ dj.airname }}'s top {{ limit }}<br><font class='subhead2'>for the {{ weeks }} week period ending {{ "now" | date("l, j F Y") }}</font></th></tr>
  <tr><td><ol>
  {{ _self.emitViewDJAlbum(topPlays, "label") }}
  </ol></td></tr>
{% endif %}
</table>
{{ topPlays | length ? "<br>" }}

<table width='100%' cellpadding=0 cellspacing=0 border=0>
  <tr><td class='recentPlays' valign=top>
    <table class='djinfo' cellspacing=0 border=0>
{% if recentPlays | length %}
      <tr><th align=left class="subhead">{{ topPlays | length ? '' : dj.airname ~ "'s" ~}} Recent airplay</th></tr>
      <tr><td><ul {{~ recentReviews | length ? ' class="sub"' }}>
      {{ _self.emitViewDJAlbum(recentPlays, "label") }}
      </ul></td></tr>
{% endif %}
    </table></td>
{% if recentReviews | length %}
    <td {{ recentPlays | length ? "&nbsp;&nbsp;&nbsp;" }}></td>
    <td class='recentReviews' valign=top>
      <table class='djinfo' border=0 cellspacing=0>
        {%~ set block = topPlays | length or recentPlays | length %}
        <tr><th align=left class='subhead'>{{ block ? '' : dj.airname ~ "'s " ~}}Recent reviews</th>
        </tr>
        <tr><td><ul style='' {{~ block ? ' class="sub"' ~}}>
        {{ _self.emitViewDJAlbum(recentReviews, "name") }}
        {%~ if recentReviews | length == count - 1 %}
        <li style='list-style-type: none'><a href='?action=viewRecent&amp;subaction=viewDJ&amp;seq=selUser&viewuser={{ dj.id }}' class='nav'>More reviews...</a></li>
        {%~ endif %}
        </ul></td></tr>
      </table>
    </td>
{% endif %}
  </tr>
</table>
{{ topPlays | length or recentPlays | length or recentReviews | length ? "<br>" }}

<form action="?" class="selector" method=post>
<table>
  <tr><th align=left>{{ dj.airname }}'s playlists:</th></tr>
  <tr><td>
     <ul tabindex='0' class='selector listbox no-text-select' data-name='playlist'>
     {%~ for playlist in playlists %}
       <li data-value="{{ playlist.id }}">{{ playlist.showdate ~ ' -- ' ~ playlist.description }}</li>
     {%~ endfor %}
     </ul></td></tr>
  <tr><td>
  <script src="{{ 'js/zklistbox.js' | decorate }}"></script>
  <script><!--
     $().ready(function() {
         $("ul.selector").zklistbox().trigger('focus');
     });
  // -->
  </script>
  <input type=submit value=" View Playlist ">
  <input type=hidden name=playlist value="">
  <input type=hidden name=viewuser value="{{ dj.id }}">
  <input type=hidden name=subaction value="viewDJ">
  <input type=hidden name=seq value="selList">
  </td></tr>
</table>
</form>
